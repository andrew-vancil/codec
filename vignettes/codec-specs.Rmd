---
title: "CODEC tabular-data-resource specifications"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{CODEC tabular-data-resource specifications}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

> *Language:* The keywords “MUST”, “MUST NOT”, “SHOULD”, “SHOULD NOT”, and “MAY” in this document are to be interpreted as described in [RFC 2119](https://tools.ietf.org/html/rfc2119).

A CODEC tabular-data-resource (or `tdr`) is designed to deal with tabular community-level data; for example:

- pediatric hospitalizations rate per month per census tract
- total number of gunshots per week per neighborhood
- housing code enforcement density per year per ZIP code

Each CODEC `tdr` consists of (1) a single table of [data](#data) and (2) its [metadata](#metadata). CODEC utilizes metadata specifications for community-level data in an effort to make them more interoperable and reusable.

### Data

Data is specified as average values or total counts for census tract geographies during a specific date range.

The required **census tract geography** and **date range** columns in a CODEC tabular-data-resource are used to specify the "where" and the "when" and importantly, can be used to link with other spatiotemporal health information:

#### Census Tract Geography

As tabular data that must specify a geography, a CODEC tabular-data-resource MUST include a [census tract](https://www2.census.gov/geo/pdfs/education/CensusTracts.pdf) column named `census_tract_id_{year}`, where `{year}` is replaced with the decennial vintage of the census tract geographies used to create the dataset (e.g., `census_tract_id_2010` or `census_tract_id_2020`).^[Alternatively, both a `census_tract_id` *and* a `census_tract_vintage` column MAY be specified, but the `census_tract_vintage` column MUST contain a unique value of `2000`, `2010`, or `2020`.]

The census tract identifier column MUST contain 11-digit [GEOID](https://www.census.gov/programs-surveys/geography/guidance/geo-identifiers.html) identifiers for *all* census tracts in Hamilton County (GEOID: 39061). A list of required census tract identifiers for 2000, 2010, and 2020 are available in the {{[cincy](https://github.com/geomarker-io/cincy)}} R package (e.g., `cincy::tract_tigris_2010`).

A CODEC `tdr` that was *not* created at a census tract level SHOULD link to a URL that contains code and a descriptive README file about how the data was harmonized (e.g., areal interpolation) with census tract geographies.

#### Date Range

- data must correspond to a year or month
- *or* require start_date and end_date and assume value represents temporal average of this time period

### File Structure

A CODEC `tabular-data-resource` (i.e., `tdr`) consists of a directory that MUST contain exactly one data (`.csv`) file and exactly one metadata file (`tabular-data-resource.yaml`).

The name of the directory and the name of the CSV file containing the data MUST be identical to the `name` [*property*](codec-metadata.html#tabular-data-resource-metadata).

For example,

    mydata
    ├── mydata.csv
    └── tabular-data-resource.yaml

Both files MUST be encoded using UTF-8 with newlines encoded as either `\n` or `\r\n`.

The data file must follow the [RFC 4180](https://www.rfc-editor.org/rfc/rfc4180) standard for CSV files.  In addition:

- the filename MUST end with `.csv`
- the first row MUST be a header row, containing the *unique* `name` of each *field*
- if a value is missing, it MUST be represented by either `NA` or an empty string (``)
  
The metadata file MUST be a [YAML](https://yaml.org/) file named `tabular-data-resource.yaml` adhering to the metadata specifications.

### Metadata

Metadata is information *about* data, but does not contain the data itself. For example, a CSV file cannot tell R (or other software) anything about itself including general information like its name, title, description, or homepage, as well as details on each column, including names, titles, types, formats, and constraints. 

The metadata of a CODEC tabular-data-resource is represented as a hierarchical list in a specific format.  On disk, this metadata is stored separately from the data as a `tabular-data-resource.yaml` file and in R, it is stored in the attributes of a data.frame.

The CODEC specifications are based on the [Frictionless](https://frictionlessdata.io/) [Data Resource](https://specs.frictionlessdata.io/data-resource/), [Table Schema](https://specs.frictionlessdata.io/table-schema/), and [Tabular Data Resource](https://specs.frictionlessdata.io/tabular-data-resource/) standards.

The metadata of a CODEC tabular-data-resource is hierarchically composed of different **descriptors** :

![](codec_metadata.png)

- **property** (or ["metadata property"](https://specs.frictionlessdata.io/data-resource/#metadata-properties)) are named values used to describe the data resource. The value of most *properties* are a single character string (e.g., `name = "my_data"`), but some are lists.

- **schema** (or ["table schema"](https://specs.frictionlessdata.io/table-schema/)) is a special *property* that is a list of information about the **fields** (or columns) in a tabular-data-resource. *schema* includes a list of *fields*, as well as the value used to denote missingness and which *fields* are primary or foreign keys.

- **fields** (or ["field descriptors"](https://specs.frictionlessdata.io/table-schema/#field-descriptors)) is a special *schema descriptor* list of each of the *fields* in a tabular-data-resource, each with different *descriptors* containing *field*-specific information.

A CODEC tabular-data-resource MUST contain `name` and `path` descriptors. All other properties, schema, and fields MAY be present, but MUST be one of:

```{r as.is = T, echo = F}
CODECtools::codec_tdr() |>
  purrr::map(tibble::enframe) |>
  tibble::enframe(name = "type", value = "data") |>
  dplyr::rowwise(type) |>
  dplyr::summarize(data, .groups = "drop") |>
  knitr::kable()
```

**All fields in the CSV data file MUST be described in the metadata and vice-versa.**

#### Example

An example CODEC tabular-data-resource looks like:

```yaml
name: tract_poverty
path: tract_poverty.csv
title: Fraction of Census Tract Households in Poverty
version: 1.2.1
description: measures derived from 5-yr 2019 American Community Survey
schema:
  fields:
    census_tract_id:
      name: census_tract_id
      title: Census Tract
      description: 2010 vintage census tract identifier
      type: string
    fraction_poverty:
      name: fraction_poverty
      title: Fraction of Households in Poverty
      type: number
```

> CODEC specifications are versioned with {CODECtools}, so this article describes version `r packageVersion("CODECtools")`.
